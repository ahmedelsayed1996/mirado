import { useTranslations } from "next-intl";
import { parseCookies } from "nookies";
import React, { useState } from "react";
// import { FaStar } from "react-icons/fa";
import { toast } from "react-toastify";
import useCurrentLang from "../_hooks/useCurrentLang";
import PopUpRating from "./PopUpRating";

type Props = {
  headers: string[];
  data: Record<string, any>[];
};

const RequestTableProgram: React.FC<Props> = ({ headers, data }) => {
  const URLUniversity = "university-reviews";
  const language = useCurrentLang();
  const { tokenMainSite } = parseCookies();
  const d = useTranslations("UniversityDetails");
  const [isLoading, setIsLoading] = useState(new Map<number, boolean>());
  const [openRate, setOpenRate] = useState(false);
  const [idUniversity, setIdUniversity] = useState<number | null>(null);

  const downloadInvoices = async (id: any) => {
    setIsLoading((prev) => new Map(prev).set(id, true));

    try {
      const res = await fetch(
        `${process.env.NEXT_PUBLIC_SERVER_URL}/bills/university/${id}`,
        {
          method: "GET",
          headers: {
            Authorization: `Bearer ${tokenMainSite}`,
          },
        }
      );
      if (!res.ok) {
        const result = await res.json();
        throw new Error(result.message);
      }
      const blob = await res.blob();
      const fileURL = URL.createObjectURL(blob);
      window.open(fileURL);
    } catch (error: any) {
      toast.error(error.message);
    } finally {
      setIsLoading((prev) => new Map(prev).set(id, false));
    }
  };

  return (
    <>
      <div className="overflow-auto w-full max-w-[1150px] mt-4">
        <table className="w-full text-start border-collapse ">
          <thead>
            <tr className="bg-primary text-white text-xs  font-bold tracking-wide">
              {headers.map((header, i) => (
                <th key={i} className="py-2 px-4 text-start">
                  {header}
                </th>
              ))}
            </tr>
          </thead>
          <tbody>
            {data?.map((item: any, index: number) => {
              return (
                <tr
                  key={index}
                  className="text-xs border-b border-[#EEEEEE] hover:bg-gray transition"
                >
                  {/* Program Name */}
                  <td className="py-2 px-4 whitespace-nowrap">
                    {item?.program?.program_translations[0].name}
                  </td>
                  {/* Program Date */}
                  <td className="py-2 px-4 whitespace-nowrap">
                    {item?.program?.start_date
                      ? new Date(item?.program?.start_date).toLocaleString(
                          "en-US",
                          { year: "numeric", month: "short" }
                        )
                      : d("drawer7")}
                    {/* {item?.program?.start_date.slice(0, 10)} */}
                  </td>
                  {/* Total Price	 */}
                  <td className="py-2 px-4 whitespace-nowrap">
                    {item?.total_price} {item?.program?.university?.currency}
                  </td>
                  {/* Language of Study */}
                  <td className="py-2 px-4 whitespace-nowrap">
                    {item?.program?.program_translations[0].course_language}
                  </td>
                  {/* Study Period */}
                  <td className="py-2 px-4 whitespace-nowrap">
                    {item?.program?.program_translations[0].price_period_type}
                  </td>
                  {/* Status */}
                  <td className="py-2 px-4 whitespace-nowrap">
                    <span
                      className={`px-2 py-1 inline-flex items-center gap-1 rounded text-xs font-medium border 
                        ${
                          item?.status === "approved"
                            ? "text-emerald-800 bg-emerald-50 border-emerald-200"
                            : item?.status === "under_process"
                            ? "text-black bg-[#F9FAFB] border-gray"
                            : item?.status === "rejected"
                            ? "text-orange-800 bg-orange-50 border-orange-200"
                            : item?.status === "approved"
                            ? "text-primary bg-[#EFF8FF] border-[#B2DDFF]"
                            : item?.status === "travelled"
                            ? "text-[#F89A21] bg-[#ffe78e3d] border-[#F89A21]"
                            : item?.status === "pending"
                            ? "text-[#93370D] bg-[#FFFAEB] border-[#FEDF89]"
                            : item?.status === "accepted"
                            ? "text-primary bg-[#EFF8FF] border-[#B2DDFF]"
                            : ""
                        }`}
                    >
                      {item?.status === "approved" ? (
                        <svg
                          width="12"
                          height="12"
                          viewBox="0 0 8 8"
                          fill="none"
                          xmlns="http://www.w3.org/2000/svg"
                        >
                          <path
                            d="M3.46964 4.59057L2.77714 3.90651C2.71984 3.85054 2.66182 3.82189 2.60307 3.82057C2.54425 3.81925 2.48536 3.84811 2.42641 3.90714C2.36599 3.96748 2.33578 4.02811 2.33578 4.08901C2.33578 4.14991 2.36536 4.20925 2.42453 4.26703L3.25089 5.09339C3.3145 5.15964 3.38714 5.19276 3.4688 5.19276C3.55054 5.19276 3.62439 5.15964 3.69036 5.09339L5.56859 3.21516C5.62491 3.15884 5.65377 3.09957 5.65516 3.03734C5.65648 2.97512 5.62762 2.91384 5.56859 2.85349C5.50825 2.79446 5.44936 2.76495 5.39193 2.76495C5.3345 2.76495 5.27672 2.79398 5.21859 2.85203L3.46964 4.59057ZM4.00141 7.70797C3.49342 7.70797 3.01405 7.61137 2.56328 7.41818C2.11245 7.22491 1.7178 6.95894 1.37932 6.62026C1.04092 6.28158 0.77526 5.88731 0.582344 5.43745C0.389427 4.98752 0.292969 4.50884 0.292969 4.00141C0.292969 3.48648 0.389566 3.00536 0.58276 2.55807C0.776024 2.11071 1.042 1.71779 1.38068 1.37932C1.71936 1.04092 2.11363 0.77526 2.56349 0.582343C3.01342 0.389427 3.4921 0.292969 3.99953 0.292969C4.51446 0.292969 4.99557 0.389566 5.44286 0.582761C5.89023 0.776024 6.28314 1.042 6.62161 1.38068C6.96002 1.71936 7.22568 2.11189 7.41859 2.55828C7.61151 3.00474 7.70797 3.48516 7.70797 3.99953C7.70797 4.50752 7.61137 4.98689 7.41818 5.43766C7.22491 5.88849 6.95894 6.28314 6.62026 6.62161C6.28158 6.96002 5.88905 7.22568 5.44266 7.41859C4.9962 7.61151 4.51578 7.70797 4.00141 7.70797Z"
                            fill="#085D3A"
                          />
                        </svg>
                      ) : item?.status === "under_process" ? (
                        <svg
                          width="12"
                          height="12"
                          viewBox="0 0 8 8"
                          fill="none"
                          xmlns="http://www.w3.org/2000/svg"
                        >
                          <path
                            d="M4.25443 3.73641V1.77453C4.25443 1.70703 4.23005 1.6487 4.1813 1.59953C4.13248 1.5503 4.07464 1.52568 4.00776 1.52568C3.93936 1.52568 3.88012 1.5503 3.83005 1.59953C3.77991 1.6487 3.75484 1.70703 3.75484 1.77453V3.82734C3.75484 3.87304 3.76342 3.9138 3.78057 3.94964C3.79766 3.98554 3.82054 4.01769 3.84922 4.04609L5.28495 5.48766C5.34155 5.54613 5.40095 5.57429 5.46318 5.57214C5.5254 5.57005 5.58672 5.5388 5.64714 5.47839C5.70616 5.41936 5.73568 5.35943 5.73568 5.29859C5.73568 5.23769 5.70512 5.1763 5.64401 5.11443L4.25443 3.73641ZM4.00141 7.70797C3.49078 7.70797 3.01075 7.61137 2.5613 7.41818C2.11179 7.22491 1.7178 6.95894 1.37932 6.62026C1.04092 6.28158 0.77526 5.88745 0.582344 5.43786C0.389427 4.98828 0.292969 4.50786 0.292969 3.99661C0.292969 3.48488 0.389566 3.00363 0.58276 2.55286C0.776024 2.10203 1.042 1.70911 1.38068 1.37411C1.71936 1.03918 2.11349 0.77526 2.56307 0.582343C3.01266 0.389427 3.49307 0.292969 4.00432 0.292969C4.51606 0.292969 4.99734 0.390399 5.44818 0.58526C5.89901 0.780191 6.29116 1.0447 6.62464 1.3788C6.95818 1.7129 7.2221 2.10516 7.41641 2.55557C7.61078 3.00606 7.70797 3.48738 7.70797 3.99953C7.70797 4.51016 7.61137 4.99019 7.41818 5.43964C7.22491 5.88915 6.96068 6.28314 6.62547 6.62161C6.29026 6.96002 5.89727 7.22568 5.44651 7.41859C4.99568 7.61151 4.51398 7.70797 4.00141 7.70797Z"
                            fill="#1F2A37"
                          />
                        </svg>
                      ) : item?.status === "rejected" ? (
                        <svg
                          width="12"
                          height="14"
                          viewBox="0 0 6 8"
                          fill="none"
                          xmlns="http://www.w3.org/2000/svg"
                        >
                          <path
                            d="M1.89049 6.32901H4.10956C4.17692 6.32901 4.2357 6.30464 4.28591 6.25589C4.33619 6.2072 4.36133 6.14898 4.36133 6.0812C4.36133 6.01349 4.33674 5.9546 4.28758 5.90453C4.23848 5.85446 4.18029 5.82943 4.11299 5.82943H1.89393C1.82504 5.82943 1.76588 5.85391 1.71643 5.90286C1.66692 5.95189 1.64216 6.00998 1.64216 6.07714C1.64216 6.14429 1.66633 6.20304 1.71466 6.25339C1.76306 6.3038 1.82168 6.32901 1.89049 6.32901ZM1.89049 4.84578H4.10956C4.17692 4.84578 4.2357 4.82144 4.28591 4.77276C4.33619 4.72401 4.36133 4.66578 4.36133 4.59807C4.36133 4.53036 4.33674 4.47144 4.28758 4.4213C4.23848 4.37123 4.18029 4.3462 4.11299 4.3462H1.89393C1.82504 4.3462 1.76588 4.37071 1.71643 4.41974C1.66692 4.46877 1.64216 4.52686 1.64216 4.59401C1.64216 4.66116 1.66633 4.71991 1.71466 4.77026C1.76306 4.82061 1.82168 4.84578 1.89049 4.84578ZM0.907266 7.70797C0.732682 7.70797 0.585043 7.6471 0.464349 7.52536C0.343585 7.40356 0.283203 7.25547 0.283203 7.08109V0.919844C0.283203 0.745469 0.344106 0.597378 0.465911 0.475573C0.587647 0.353836 0.736016 0.292969 0.911016 0.292969H3.83966C3.9214 0.292969 4.00268 0.307586 4.08352 0.336823C4.16428 0.366059 4.23431 0.413142 4.29362 0.478072L5.52508 1.71536C5.59049 1.77384 5.63852 1.84255 5.66914 1.92151C5.69977 2.00047 5.71508 2.08099 5.71508 2.16307V7.08016C5.71508 7.25516 5.65414 7.40356 5.53227 7.52536C5.41046 7.6471 5.26227 7.70797 5.08768 7.70797H0.907266ZM3.73268 1.96203C3.73268 2.0487 3.76324 2.12259 3.82435 2.1837C3.88546 2.24474 3.95935 2.27526 4.04602 2.27526H5.2155L3.73268 0.792552V1.96203Z"
                            fill="#912018"
                          />
                        </svg>
                      ) : item?.status === "approved" ? (
                        <svg
                          width="12"
                          height="12"
                          viewBox="0 0 6 8"
                          fill="none"
                          xmlns="http://www.w3.org/2000/svg"
                        >
                          <path
                            d="M1.89049 6.32901H4.10956C4.17692 6.32901 4.2357 6.30464 4.28591 6.25589C4.33619 6.2072 4.36133 6.14898 4.36133 6.0812C4.36133 6.01349 4.33674 5.9546 4.28758 5.90453C4.23848 5.85446 4.18029 5.82943 4.11299 5.82943H1.89393C1.82504 5.82943 1.76588 5.85391 1.71643 5.90286C1.66692 5.95189 1.64216 6.00998 1.64216 6.07714C1.64216 6.14429 1.66633 6.20304 1.71466 6.25339C1.76306 6.3038 1.82168 6.32901 1.89049 6.32901ZM1.89049 4.84578H4.10956C4.17692 4.84578 4.2357 4.82144 4.28591 4.77276C4.33619 4.72401 4.36133 4.66578 4.36133 4.59807C4.36133 4.53036 4.33674 4.47144 4.28758 4.4213C4.23848 4.37123 4.18029 4.3462 4.11299 4.3462H1.89393C1.82504 4.3462 1.76588 4.37071 1.71643 4.41974C1.66692 4.46877 1.64216 4.52686 1.64216 4.59401C1.64216 4.66116 1.66633 4.71991 1.71466 4.77026C1.76306 4.82061 1.82168 4.84578 1.89049 4.84578ZM0.907266 7.70797C0.732682 7.70797 0.585043 7.6471 0.464349 7.52536C0.343585 7.40356 0.283203 7.25547 0.283203 7.08109V0.919844C0.283203 0.745469 0.344106 0.597378 0.465911 0.475573C0.587647 0.353836 0.736016 0.292969 0.911016 0.292969H3.83966C3.9214 0.292969 4.00268 0.307586 4.08352 0.336823C4.16428 0.366059 4.23431 0.413142 4.29362 0.478072L5.52508 1.71536C5.59049 1.77384 5.63852 1.84255 5.66914 1.92151C5.69977 2.00047 5.71508 2.08099 5.71508 2.16307V7.08016C5.71508 7.25516 5.65414 7.40356 5.53227 7.52536C5.41046 7.6471 5.26227 7.70797 5.08768 7.70797H0.907266ZM3.73268 1.96203C3.73268 2.0487 3.76324 2.12259 3.82435 2.1837C3.88546 2.24474 3.95935 2.27526 4.04602 2.27526H5.2155L3.73268 0.792552V1.96203Z"
                            fill="#1849A9"
                          />
                        </svg>
                      ) : item?.status === "travelled" ? (
                        <svg
                          width="12"
                          height="12"
                          viewBox="0 0 8 8"
                          fill="none"
                          xmlns="http://www.w3.org/2000/svg"
                        >
                          <path
                            d="M3.39714 4.52766L0.855885 5.5562C0.72033 5.61009 0.592621 5.59533 0.47276 5.51193C0.352899 5.42845 0.292969 5.31592 0.292969 5.17432V4.99443C0.292969 4.92971 0.307656 4.86863 0.337031 4.8112C0.366406 4.75377 0.408455 4.70655 0.463177 4.66953L3.39714 2.63891V0.896302C3.39714 0.730677 3.45616 0.588732 3.57422 0.470469C3.69227 0.352135 3.83505 0.292969 4.00255 0.292969C4.17019 0.292969 4.31318 0.352135 4.43151 0.470469C4.54984 0.588732 4.60901 0.730677 4.60901 0.896302V2.64026L7.54557 4.67255C7.59724 4.70852 7.63807 4.75547 7.66807 4.81339C7.69814 4.87137 7.71318 4.93175 7.71318 4.99453V5.17443C7.71318 5.31589 7.65325 5.42835 7.53339 5.51182C7.41352 5.59529 7.28582 5.61009 7.15026 5.5562L4.60901 4.52766L4.60578 6.11224L5.66193 6.85266C5.70609 6.87745 5.74043 6.91241 5.76495 6.95755C5.78946 7.00262 5.80172 7.05238 5.80172 7.10682V7.29443C5.80172 7.40241 5.76182 7.48693 5.68203 7.54797C5.60224 7.60894 5.513 7.6237 5.41432 7.59224L4.00047 7.16068L2.58953 7.59349C2.48793 7.62411 2.39748 7.60828 2.31818 7.54599C2.23887 7.4837 2.19922 7.39932 2.19922 7.29286V7.10693C2.19922 7.0545 2.21148 7.00523 2.23599 6.95911C2.2605 6.91307 2.2955 6.87759 2.34099 6.85266L3.39714 6.11224V4.52766Z"
                            fill="#F89A21"
                          />
                        </svg>
                      ) : item?.status === "pending" ? (
                        <svg
                          width="12"
                          height="12"
                          viewBox="0 0 8 8"
                          fill="none"
                          xmlns="http://www.w3.org/2000/svg"
                        >
                          <path
                            d="M4.00266 5.85422C4.07036 5.85422 4.12925 5.82967 4.17932 5.78057C4.22939 5.73148 4.25443 5.67241 4.25443 5.60339V3.75766C4.25443 3.69023 4.23005 3.63189 4.1813 3.58266C4.13248 3.53349 4.07464 3.50891 4.00776 3.50891C3.93936 3.50891 3.88012 3.53349 3.83005 3.58266C3.77991 3.63189 3.75484 3.69023 3.75484 3.75766V5.60339C3.75484 5.67241 3.77922 5.73148 3.82797 5.78057C3.87665 5.82967 3.93488 5.85422 4.00266 5.85422ZM3.99714 2.90432C4.07658 2.90432 4.14332 2.87839 4.19734 2.82651C4.25144 2.77464 4.27849 2.70898 4.27849 2.62953C4.27849 2.55016 4.25255 2.48342 4.20068 2.42932C4.1488 2.37529 4.08318 2.34828 4.0038 2.34828C3.92436 2.34828 3.85762 2.37422 3.80359 2.42609C3.7495 2.47797 3.72245 2.54359 3.72245 2.62297C3.72245 2.70234 3.74839 2.76908 3.80026 2.82318C3.85214 2.87727 3.91776 2.90432 3.99714 2.90432ZM4.00432 7.70797C3.49439 7.70797 3.01405 7.61137 2.56328 7.41818C2.11245 7.22491 1.7178 6.95894 1.37932 6.62026C1.04092 6.28158 0.77526 5.88745 0.582344 5.43786C0.389427 4.98828 0.292969 4.50786 0.292969 3.99661C0.292969 3.48488 0.389566 3.00536 0.58276 2.55807C0.776024 2.11071 1.042 1.71779 1.38068 1.37932C1.71936 1.04092 2.11349 0.77526 2.56307 0.582343C3.01266 0.389427 3.49307 0.292969 4.00432 0.292969C4.51606 0.292969 4.99557 0.389566 5.44286 0.582761C5.89023 0.776024 6.28314 1.042 6.62161 1.38068C6.96002 1.71936 7.22568 2.11269 7.41859 2.56068C7.61151 3.00866 7.70797 3.48731 7.70797 3.99661C7.70797 4.50655 7.61137 4.98689 7.41818 5.43766C7.22491 5.88849 6.95894 6.28314 6.62026 6.62161C6.28158 6.96002 5.88825 7.22568 5.44026 7.41859C4.99227 7.61151 4.51363 7.70797 4.00432 7.70797Z"
                            fill="#93370D"
                          />
                        </svg>
                      ) : item?.status === "accepted" ? (
                        <svg
                          width="12"
                          height="12"
                          viewBox="0 0 6 8"
                          fill="none"
                          xmlns="http://www.w3.org/2000/svg"
                        >
                          <path
                            d="M1.89049 6.32901H4.10956C4.17692 6.32901 4.2357 6.30464 4.28591 6.25589C4.33619 6.2072 4.36133 6.14898 4.36133 6.0812C4.36133 6.01349 4.33674 5.9546 4.28758 5.90453C4.23848 5.85446 4.18029 5.82943 4.11299 5.82943H1.89393C1.82504 5.82943 1.76588 5.85391 1.71643 5.90286C1.66692 5.95189 1.64216 6.00998 1.64216 6.07714C1.64216 6.14429 1.66633 6.20304 1.71466 6.25339C1.76306 6.3038 1.82168 6.32901 1.89049 6.32901ZM1.89049 4.84578H4.10956C4.17692 4.84578 4.2357 4.82144 4.28591 4.77276C4.33619 4.72401 4.36133 4.66578 4.36133 4.59807C4.36133 4.53036 4.33674 4.47144 4.28758 4.4213C4.23848 4.37123 4.18029 4.3462 4.11299 4.3462H1.89393C1.82504 4.3462 1.76588 4.37071 1.71643 4.41974C1.66692 4.46877 1.64216 4.52686 1.64216 4.59401C1.64216 4.66116 1.66633 4.71991 1.71466 4.77026C1.76306 4.82061 1.82168 4.84578 1.89049 4.84578ZM0.907266 7.70797C0.732682 7.70797 0.585043 7.6471 0.464349 7.52536C0.343585 7.40356 0.283203 7.25547 0.283203 7.08109V0.919844C0.283203 0.745469 0.344106 0.597378 0.465911 0.475573C0.587647 0.353836 0.736016 0.292969 0.911016 0.292969H3.83966C3.9214 0.292969 4.00268 0.307586 4.08352 0.336823C4.16428 0.366059 4.23431 0.413142 4.29362 0.478072L5.52508 1.71536C5.59049 1.77384 5.63852 1.84255 5.66914 1.92151C5.69977 2.00047 5.71508 2.08099 5.71508 2.16307V7.08016C5.71508 7.25516 5.65414 7.40356 5.53227 7.52536C5.41046 7.6471 5.26227 7.70797 5.08768 7.70797H0.907266ZM3.73268 1.96203C3.73268 2.0487 3.76324 2.12259 3.82435 2.1837C3.88546 2.24474 3.95935 2.27526 4.04602 2.27526H5.2155L3.73268 0.792552V1.96203Z"
                            fill="#1849A9"
                          />
                        </svg>
                      ) : (
                        ""
                      )}
                      {item?.status === "under_process"
                        ? "In Progress"
                        : item?.status === "rejected"
                        ? "Document rejected"
                        : item?.status === "approved"
                        ? "Completed"
                        : item?.status === "travelled"
                        ? "Traveled"
                        : item?.status === "pending"
                        ? "Pending"
                        : item?.status === "accepted"
                        ? "Document Accepted"
                        : ""}
                    </span>
                  </td>
                  {/* Rate */}
                  <td className="py-2 px-4 whitespace-nowrap ">
                    {item.rating > 0 ? (
                      <div className="flex  gap-1">
                        {[...Array(5)].map((_, index) => {
                          const currentRate = index + 1;
                          const isActive = item.rating >= currentRate;
                          return (
                            <svg
                              key={index}
                              width="20"
                              height="17"
                              viewBox="0 0 30 27"
                              fill="none"
                              xmlns="http://www.w3.org/2000/svg"
                            >
                              <path
                                d="M14.2613 0.576726C14.5346 -0.0803083 15.4654 -0.0803101 15.7387 0.576724L19.0444 8.52469C19.1596 8.80168 19.4201 8.99093 19.7191 9.01491L28.2996 9.7028C29.0089 9.75967 29.2966 10.6449 28.7561 11.1078L22.2187 16.7078C21.9909 16.903 21.8914 17.2092 21.961 17.501L23.9583 25.8741C24.1234 26.5663 23.3704 27.1134 22.7631 26.7425L15.417 22.2555C15.161 22.0991 14.839 22.0991 14.583 22.2555L7.2369 26.7425C6.62962 27.1134 5.87661 26.5663 6.04172 25.8741L8.03902 17.501C8.10862 17.2092 8.00913 16.903 7.78129 16.7078L1.24386 11.1078C0.703432 10.6449 0.991051 9.75967 1.70037 9.7028L10.2809 9.01491C10.5799 8.99093 10.8404 8.80168 10.9556 8.52469L14.2613 0.576726Z"
                                fill={isActive ? "#FDB022" : "#F0F0F0"}
                              />
                            </svg>
                          );
                        })}
                      </div>
                    ) : (
                      <button
                        className="py-2 px-4 flex items-center gap-2 border border-[#EEEEEE] rounded-md "
                        onClick={() => {
                          setIdUniversity(item?.program?.university?.id);
                          setOpenRate(true);
                        }}
                      >
                        <svg
                          width="18"
                          height="18"
                          viewBox="0 0 18 18"
                          fill="#EEEEEE"
                          xmlns="http://www.w3.org/2000/svg"
                        >
                          <path
                            d="M11.0664 5.76953C11.2104 6.11556 11.5356 6.35176 11.9092 6.38184L17.2725 6.8125L13.1865 10.3125C12.9018 10.5565 12.7773 10.939 12.8643 11.3037L14.1123 16.5371L9.52148 13.7324C9.20147 13.537 8.79853 13.537 8.47852 13.7324L3.8877 16.5371L5.13574 11.3037C5.22274 10.939 5.09819 10.5565 4.81348 10.3125L0.727539 6.8125L6.09082 6.38184C6.4644 6.35176 6.78959 6.11557 6.93359 5.76953L9 0.801758L11.0664 5.76953Z"
                            stroke="#A5A5A5"
                          />
                        </svg>
                        Rate Program
                      </button>
                    )}
                  </td>
                  {/* Actions  */}
                  <td className="py-2 px-4 whitespace-nowrap  ">
                    <div className="flex gap-2">
                      <div
                        className="flex shrink-0 self-stretch my-auto p-1 bg-white rounded border border-solid border-zinc-100 cursor-pointer"
                        onClick={() => downloadInvoices(item?.id)}
                      >
                        <div className="relative flex flex-col items-center group">
                          {isLoading.get(item?.id) ? (
                            <svg
                              width="18"
                              height="18"
                              xmlns="http://www.w3.org/2000/svg"
                              viewBox="0 0 512 512"
                            >
                              <path d="M304 48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zm0 416a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zM48 304a48 48 0 1 0 0-96 48 48 0 1 0 0 96zm464-48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zM142.9 437A48 48 0 1 0 75 369.1 48 48 0 1 0 142.9 437zm0-294.2A48 48 0 1 0 75 75a48 48 0 1 0 67.9 67.9zM369.1 437A48 48 0 1 0 437 369.1 48 48 0 1 0 369.1 437z" />
                            </svg>
                          ) : (
                            <svg
                              width="20"
                              height="20"
                              viewBox="0 0 16 16"
                              fill="none"
                              xmlns="http://www.w3.org/2000/svg"
                            >
                              <path
                                d="M13.6666 6.79398H11.74C10.16 6.79398 8.87329 5.50732 8.87329 3.92732V2.00065C8.87329 1.63398 8.57329 1.33398 8.20663 1.33398H5.37996C3.32663 1.33398 1.66663 2.66732 1.66663 5.04732V10.954C1.66663 13.334 3.32663 14.6673 5.37996 14.6673H10.62C12.6733 14.6673 14.3333 13.334 14.3333 10.954V7.46065C14.3333 7.09398 14.0333 6.79398 13.6666 6.79398ZM8.18663 10.5207L6.85329 11.854C6.80663 11.9007 6.74663 11.9407 6.68663 11.9607C6.62663 11.9873 6.56663 12.0007 6.49996 12.0007C6.43329 12.0007 6.37329 11.9873 6.31329 11.9607C6.25996 11.9407 6.20663 11.9007 6.16663 11.8607C6.15996 11.854 6.15329 11.854 6.15329 11.8473L4.81996 10.514C4.62663 10.3207 4.62663 10.0007 4.81996 9.80732C5.01329 9.61398 5.33329 9.61398 5.52663 9.80732L5.99996 10.294V7.50065C5.99996 7.22732 6.22663 7.00065 6.49996 7.00065C6.77329 7.00065 6.99996 7.22732 6.99996 7.50065V10.294L7.47996 9.81398C7.67329 9.62065 7.99329 9.62065 8.18663 9.81398C8.37996 10.0073 8.37996 10.3273 8.18663 10.5207Z"
                                fill="#07C37B"
                              />
                              <path
                                d="M11.62 5.87365C12.2533 5.88032 13.1333 5.88032 13.8866 5.88032C14.2666 5.88032 14.4666 5.43365 14.2 5.16699C13.24 4.20032 11.52 2.46032 10.5333 1.47365C10.26 1.20032 9.78662 1.38699 9.78662 1.76699V4.09365C9.78662 5.06699 10.6133 5.87365 11.62 5.87365Z"
                                fill="#07C37B"
                              />
                            </svg>
                          )}
                          <div className="absolute bottom-0  flex-col items-center hidden mb-5 group-hover:flex">
                            <span className="relative rounded-md z-10 p-2 text-xs leading-none text-black whitespace-no-wrap bg-white shadow-2xl flex items-center gap-1">
                              Download Invoice
                              <svg
                                width="18"
                                height="18"
                                viewBox="0 0 18 18"
                                fill="none"
                                xmlns="http://www.w3.org/2000/svg"
                              >
                                <path
                                  fillRule="evenodd"
                                  clipRule="evenodd"
                                  d="M17.25 9C17.25 13.5563 13.5563 17.25 9 17.25C4.44365 17.25 0.75 13.5563 0.75 9C0.75 4.44365 4.44365 0.75 9 0.75C13.5563 0.75 17.25 4.44365 17.25 9ZM8.11268 6.20681C8.41808 6.02732 8.77715 5.96171 9.12629 6.0216C9.47543 6.08148 9.79211 6.263 10.0202 6.53401C10.2484 6.80501 10.3732 7.148 10.3727 7.50224L10.3727 7.50336C10.3727 7.85521 10.0989 8.22202 9.58168 8.56682C9.3459 8.724 9.10479 8.8451 8.91966 8.92737C8.82817 8.96804 8.75296 8.99807 8.70239 9.01734C8.67716 9.02695 8.65825 9.03381 8.64672 9.03791L8.63514 9.04198C8.24244 9.17311 8.03025 9.5977 8.16119 9.99053C8.29218 10.3835 8.71692 10.5959 9.10988 10.4649L8.8727 9.75336C9.10988 10.4649 9.11082 10.4646 9.11082 10.4646L9.11196 10.4642L9.11489 10.4632L9.12318 10.4604L9.14923 10.4512C9.17065 10.4436 9.20008 10.4329 9.23638 10.4191C9.30886 10.3915 9.40943 10.3512 9.52887 10.2981C9.76562 10.1929 10.087 10.0327 10.4137 9.8149C11.0214 9.40978 11.8724 8.65181 11.8727 7.50404C11.8737 6.79572 11.6239 6.1099 11.1678 5.568C10.7115 5.026 10.0782 4.66296 9.37988 4.54319C8.6816 4.42341 7.96346 4.55463 7.35266 4.91361C6.74186 5.27258 6.27781 5.83614 6.0427 6.50448C5.90525 6.89522 6.11058 7.3234 6.50132 7.46086C6.89206 7.59831 7.32025 7.39298 7.45771 7.00224C7.57526 6.66807 7.80728 6.38629 8.11268 6.20681ZM8.9327 12.0034C8.51849 12.0034 8.1827 12.3391 8.1827 12.7534C8.1827 13.1676 8.51849 13.5034 8.9327 13.5034H8.9402C9.35442 13.5034 9.6902 13.1676 9.6902 12.7534C9.6902 12.3391 9.35442 12.0034 8.9402 12.0034H8.9327Z"
                                  fill="#384250"
                                />
                              </svg>
                            </span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </td>
                </tr>
              );
            })}
          </tbody>
        </table>

        {/* Display PopUpRating */}
        {openRate && idUniversity !== null && (
          <PopUpRating
            closeRate={() => setOpenRate(false)}
            ID={idUniversity}
            URL={URLUniversity}
            TheKey={"university_id"}
          />
        )}
      </div>
    </>
  );
};

export default RequestTableProgram;
