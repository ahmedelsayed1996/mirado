import { useTranslations } from "next-intl";
import Link from "next/link";
import { parseCookies } from "nookies";
import { useEffect, useState } from "react";
import useCurrentLang from "../_hooks/useCurrentLang";


interface SelectCurrencyProps {
  onClose: () => void; // الدالة لإغلاق المكون
  orderID: string; // الدالة لإغلاق المكون
}

function PaymentDone({ onClose, orderID }: SelectCurrencyProps) {
  console.log("order", orderID);
  const [isLoading, setIsLoading] = useState(false);
  const { tokenMainSite } = parseCookies();
  const language = useCurrentLang();
  const t = useTranslations("Popup");

  const downloadInvoices = async (order: any) => {
    console.log("order ", order);
    console.log("order ", order.id);
    const { id } = order
    setIsLoading(true);
    try {
      const res = await fetch(`${process.env.NEXT_PUBLIC_SERVER_URL}/bills/institute/${id}`, {
        method: "GET",
        headers: {
          Authorization: `Bearer ${tokenMainSite}`,
        }
      })
      const blob = await res.blob();
      console.log(blob);
      const fileURL = URL.createObjectURL(blob);
      window.open(fileURL);
      setIsLoading(false);
    } catch (error) {
      setIsLoading(false);
      console.log(error);
    }
  }

  useEffect(() => {
    localStorage.removeItem("orderInstitute")
  }, [])


  return (
    <div className="py-5 bg-white rounded-3xl">
      <div className="flex flex-col items-center bg-white rounded-3xl">
        <div className="flex flex-col items-center md:mt-9">
          <div className="">
            <svg width="100" height="119" viewBox="0 0 116 129" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M100.175 14.4394V108.352C100.175 112.542 96.7775 115.94 92.5869 115.94H21.666C17.4753 115.94 14.0781 112.542 14.0781 108.352V14.4394C14.0781 10.2488 17.4753 6.85156 21.666 6.85156H92.5869C96.7775 6.85156 100.175 10.2488 100.175 14.4394Z" fill="#FF9933" />
              <path d="M100.175 14.4394V108.352C100.175 112.542 96.7775 115.94 92.5869 115.94H21.666C17.4753 115.94 14.0781 112.542 14.0781 108.352V108.225H69.9093C82.364 108.225 92.4606 98.1287 92.4606 85.674V6.85156H92.5869C96.7775 6.85156 100.175 10.2488 100.175 14.4394Z" fill="#FF8B22" />
              <path d="M92.5928 14.4375H21.6719V108.352H92.5928V14.4375Z" fill="#E5E8F9" />
              <path d="M92.5928 14.4375V108.35H21.6719V99.2698H54.3458C70.4543 99.2698 83.5127 86.2113 83.5127 70.1029V14.4375H92.5928Z" fill="#D6DBF2" />
              <path d="M79.0067 3.41013V14.7666C79.0067 16.1635 77.8743 17.2959 76.4774 17.2959H37.7793C36.3824 17.2959 35.25 16.1635 35.25 14.7666V3.41013C35.25 2.01326 36.3824 0.880859 37.7793 0.880859H76.4774C77.8743 0.880859 79.0067 2.01326 79.0067 3.41013Z" fill="#666666" />
              <path d="M79.0067 3.41013V14.7666C79.0067 16.1577 77.8685 17.2959 76.4774 17.2959H37.7793C36.3882 17.2959 35.25 16.1577 35.25 14.7666V11.9591H64.6617C69.6367 11.9591 73.6697 7.92615 73.6697 2.9512V0.880859H76.4774C77.8685 0.880859 79.0067 2.01903 79.0067 3.41013Z" fill="#595857" />
              <path d="M84.2733 34.6188H47.6668C46.8631 34.6188 46.2109 33.9667 46.2109 33.1629C46.2109 32.3592 46.8631 31.707 47.6668 31.707H84.2733C85.0771 31.707 85.7292 32.3592 85.7292 33.1629C85.7292 33.9667 85.0771 34.6188 84.2733 34.6188Z" fill="#666666" />
              <path d="M73.5457 42.4918H47.6668C46.8631 42.4918 46.2109 41.8397 46.2109 41.036C46.2109 40.2322 46.8631 39.5801 47.6668 39.5801H73.5457C74.3495 39.5801 75.0016 40.2322 75.0016 41.036C75.0016 41.8397 74.3495 42.4918 73.5457 42.4918Z" fill="#666666" />
              <path d="M32.5298 42.3122C32.1431 42.3122 31.7725 42.1587 31.4995 41.8857L28.9726 39.3568C28.4048 38.7881 28.4048 37.8668 28.9735 37.2981C29.5422 36.7294 30.4645 36.7294 31.0332 37.2981L32.5298 38.7976L37.7515 33.5769C38.3202 33.0082 39.2415 33.0082 39.8102 33.5769C40.3789 34.1456 40.3789 35.0669 39.8102 35.6356L33.5592 41.8857C33.2862 42.1587 32.9156 42.3122 32.5298 42.3122Z" fill="#666666" />
              <path d="M84.2733 53.9567H47.6668C46.8631 53.9567 46.2109 53.3046 46.2109 52.5008C46.2109 51.697 46.8631 51.0449 47.6668 51.0449H84.2733C85.0771 51.0449 85.7292 51.697 85.7292 52.5008C85.7292 53.3046 85.0771 53.9567 84.2733 53.9567Z" fill="#666666" />
              <path d="M73.5457 61.8297H47.6668C46.8631 61.8297 46.2109 61.1776 46.2109 60.3738C46.2109 59.5701 46.8631 58.918 47.6668 58.918H73.5457C74.3495 58.918 75.0016 59.5701 75.0016 60.3738C75.0016 61.1776 74.3495 61.8297 73.5457 61.8297Z" fill="#666666" />
              <path d="M32.5297 61.6521C32.1572 61.6521 31.7847 61.5099 31.5004 61.2255L28.9734 58.6986C28.4047 58.1299 28.4047 57.2086 28.9734 56.6399C29.5421 56.0712 30.4634 56.0712 31.0321 56.6399L32.5297 58.1375L37.7513 52.9168C38.3201 52.3481 39.2414 52.3481 39.8101 52.9168C40.3788 53.4855 40.3788 54.4068 39.8101 54.9755L33.5591 61.2255C33.2747 61.5099 32.9022 61.6521 32.5297 61.6521Z" fill="#666666" />
              <path d="M84.2733 73.2985H47.6668C46.8631 73.2985 46.2109 72.6464 46.2109 71.8426C46.2109 71.0388 46.8631 70.3867 47.6668 70.3867H84.2733C85.0771 70.3867 85.7292 71.0388 85.7292 71.8426C85.7292 72.6464 85.0771 73.2985 84.2733 73.2985Z" fill="#666666" />
              <path d="M73.5457 81.1715H47.6668C46.8631 81.1715 46.2109 80.5194 46.2109 79.7156C46.2109 78.9119 46.8631 78.2598 47.6668 78.2598H73.5457C74.3495 78.2598 75.0016 78.9119 75.0016 79.7156C75.0016 80.5194 74.3495 81.1715 73.5457 81.1715Z" fill="#666666" />
              <path d="M32.5297 80.9919C32.1572 80.9919 31.7847 80.8498 31.5004 80.5654L28.9734 78.0384C28.4047 77.4697 28.4047 76.5484 28.9734 75.9797C29.5421 75.411 30.4634 75.411 31.0321 75.9797L32.5297 77.4773L37.7513 72.2566C38.3201 71.6879 39.2414 71.6879 39.8101 72.2566C40.3788 72.8253 40.3788 73.7466 39.8101 74.3153L33.5591 80.5654C33.2747 80.8497 32.9022 80.9919 32.5297 80.9919Z" fill="#666666" />
              <path d="M43.5773 90.0285V122.084C43.5773 123.76 42.2188 125.119 40.543 125.119H3.11251C1.43666 125.119 0.078125 123.76 0.078125 122.084V90.0285C0.078125 88.3527 1.43668 86.9941 3.11251 86.9941H40.543C42.2188 86.9941 43.5773 88.3527 43.5773 90.0285Z" fill="#FFC776" />
              <path d="M43.5773 90.0285V122.084C43.5773 123.753 42.2119 125.119 40.543 125.119H3.11251C1.44361 125.119 0.078125 123.753 0.078125 122.084V118.516H24.0228C31.1759 118.516 36.9746 112.717 36.9746 105.564V86.9941H40.543C42.2119 86.9941 43.5773 88.3596 43.5773 90.0285Z" fill="#F4B25B" />
              <path d="M26.4645 86.9941H17.2031V96.636H26.4645V86.9941Z" fill="#FFEAA9" />
              <path d="M28.8623 113.929H13.6903C12.8865 113.929 12.2344 113.277 12.2344 112.473C12.2344 111.67 12.8865 111.018 13.6903 111.018H28.8623C29.6661 111.018 30.3182 111.67 30.3182 112.473C30.3182 113.277 29.6661 113.929 28.8623 113.929Z" fill="#C48A57" />
              <path d="M28.8623 107.463H13.6903C12.8865 107.463 12.2344 106.81 12.2344 106.007C12.2344 105.203 12.8865 104.551 13.6903 104.551H28.8623C29.6661 104.551 30.3182 105.203 30.3182 106.007C30.3182 106.81 29.6661 107.463 28.8623 107.463Z" fill="#C48A57" />
              <path d="M99.4684 123.833C108.082 120.265 112.172 110.39 108.604 101.777C105.036 93.1642 95.1618 89.074 86.5487 92.6417C77.9355 96.2094 73.8453 106.084 77.413 114.697C80.9807 123.31 90.8552 127.4 99.4684 123.833Z" fill="#77E244" />
              <path d="M109.902 108.224C109.902 117.578 102.34 125.11 93.0164 125.11C86.6079 125.11 81.0503 121.557 78.1953 116.333C80.5947 117.639 83.3585 118.368 86.2739 118.368C95.5974 118.368 103.13 110.836 103.13 101.482C103.13 98.5662 102.4 95.833 101.095 93.4336C106.349 96.2884 109.902 101.846 109.902 108.224Z" fill="#62D333" />
              <path d="M90.6842 113.606C90.3117 113.606 89.9392 113.464 89.6548 113.18L86.489 110.014C85.9203 109.445 85.9203 108.524 86.489 107.955C87.0577 107.386 87.979 107.386 88.5477 107.955L90.6842 110.092L97.483 103.294C98.0517 102.725 98.9731 102.725 99.5418 103.294C100.11 103.862 100.11 104.784 99.5418 105.352L91.7136 113.18C91.4292 113.464 91.0567 113.606 90.6842 113.606Z" fill="white" />
            </svg>
          </div>
          <div className="flex flex-col self-stretch mt-5 w-full text-zinc-800 max-md:max-w-full">
            <div className="text-lg lg:text-2xl font-bold text-center text-zinc-800 max-md:max-w-full">
              {t("quote1")}
            </div>
            <div className="text-sm md:text-base text-center tracking-wide leading-loose text-zinc-800 max-md:max-w-full">
              {t("quote2")}
            </div>
          </div>
          {isLoading ? <div className="flex gap-1 items-center mt-5 text-base tracking-wide leading-loose my-auto text-blue-500" >
            {t("quote3")}  ...
          </div> :
            <div className="flex gap-1 items-center mt-5 text-base tracking-wide leading-loose cursor-pointer"
              onClick={() => downloadInvoices(orderID)}>
              <svg width="23" height="23" viewBox="0 0 23 23" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M19.291 9.84148H16.6419C14.4694 9.84148 12.7002 8.07232 12.7002 5.89982V3.25065C12.7002 2.74648 12.2877 2.33398 11.7835 2.33398H7.89685C5.07352 2.33398 2.79102 4.16732 2.79102 7.43982V15.5615C2.79102 18.834 5.07352 20.6673 7.89685 20.6673H15.1019C17.9252 20.6673 20.2077 18.834 20.2077 15.5615V10.7582C20.2077 10.254 19.7952 9.84148 19.291 9.84148ZM11.756 14.9657L9.92268 16.799C9.85852 16.8632 9.77602 16.9182 9.69352 16.9457C9.61102 16.9823 9.52852 17.0007 9.43685 17.0007C9.34518 17.0007 9.26268 16.9823 9.18018 16.9457C9.10685 16.9182 9.03352 16.8632 8.97852 16.8082C8.96935 16.799 8.96018 16.799 8.96018 16.7898L7.12685 14.9565C6.86102 14.6907 6.86102 14.2507 7.12685 13.9848C7.39268 13.719 7.83268 13.719 8.09852 13.9848L8.74935 14.654V10.8132C8.74935 10.4373 9.06102 10.1257 9.43685 10.1257C9.81268 10.1257 10.1243 10.4373 10.1243 10.8132V14.654L10.7843 13.994C11.0502 13.7282 11.4902 13.7282 11.756 13.994C12.0218 14.2598 12.0218 14.6998 11.756 14.9657Z" fill="#2A73FF" />
                <path d="M16.4779 8.57627C17.3487 8.58544 18.5587 8.58544 19.5945 8.58544C20.117 8.58544 20.392 7.97127 20.0254 7.60461C18.7054 6.27544 16.3404 3.88294 14.9837 2.52627C14.6079 2.15044 13.957 2.40711 13.957 2.92961V6.12877C13.957 7.46711 15.0937 8.57627 16.4779 8.57627Z" fill="#2A73FF" />
              </svg>

              <div className="self-stretch my-auto text-blue-500" >
                {t("quote4")}
              </div>
            </div>}
        </div>
        <div className="flex flex-wrap gap-4 justify-center items-center mt-6 text-base font-medium tracking-wide">
          <Link href={`/${language}/my-requests`} className="flex gap-1 justify-center items-center px-20 py-3 my-auto border border-solid border-primary rounded-[64px] text-primary ">
            <div className="self-stretch my-auto text-primary">
              {t("quote5")}
            </div>
          </Link>
          <Link href={`/${language}/language-schools`} className="flex gap-1 justify-center items-center px-20 py-3 my-auto text-white border border-solid bg-primary border-primary rounded-[64px] ">
            <div className="self-stretch my-auto text-white">
              {t("quote7")}
            </div>
          </Link>
        </div>
      </div>
    </div>
  );
}

export default PaymentDone;
